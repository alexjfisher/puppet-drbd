resource <%= @name %> {

  device    <%= @device %>;
  disk      <%= @disk %>;
  meta-disk internal;

  net {
    cram-hmac-alg sha1;
    verify-alg <%= @verify_alg %>;
<% unless @protocol.nil? -%>
    protocol  <%= @protocol %>;
<% end -%>
<% if @secret -%>
    shared-secret "<%= @secret %>";
<% end -%>
<% @net_parameters.sort_by {|k, v| k}.each do |k, v| -%>
    <%= k %> <%= v %>;
<% end -%>
  }

  disk {
<% if @rate -%>
    resync-rate <%= @rate %>;
<% end -%>
  }

